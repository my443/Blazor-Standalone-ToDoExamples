@page "/listwithdate"
@using ToDo.Client.Data
@using ToDo.Client.Models

<h3>List With Date</h3>
<button @onclick="AddItem">Add Item</button>
<button @onclick="DeleteItem">Delete Item</button>
<InputDate id="datepicker" @bind-Value="SelectedDate" class="form-control" style="width:200px"/>
<button @onclick="SetPreviousDay">Previous Day</button>
<button @onclick="SetToday">Today</button>
<button @onclick="SetNextDay">Next Day</button>


<table>
    @foreach (var item in ToDoItems)
    {
        <tr>
            <td><InputCheckbox @bind-Value="item.IsDone" /></td>
            <td><InputText @bind-Value="item.Title" /></td>
            <td>
                <InputRadioGroup @bind-Value="SelectedItemId" Name="Selected">
                    <InputRadio Value="@item.Id" />
                </InputRadioGroup>
            </td>
        </tr>
    }
</table>

<p>Selected Item ID: @SelectedItemId</p>
<h4>Items</h4>

<ul>
    @foreach (var item in ToDoItems)
    {
        <li>@item.Id / @item.Title / @item.IsDone</li>
    }
</ul>
@code {
    private AppDbContext context = new AppDbContext();
    private List<ToDoItem> ToDoItems;
    private int? SelectedItemId;
    private DateTime SelectedDate;

    private ToDoItem SelectedItem;

    protected override async Task OnInitializedAsync()
    {
        ToDoItems = context.ToDoItems;
        SelectedDate = DateTime.Now;
        SelectFirstItem();

    }

    private void AddItem()
    {
        // int newId = ToDoItems.Max(item => item.Id) + 1;
        int newId = ToDoItems.Select(item => item.Id).DefaultIfEmpty().Max() + 1;

        ToDoItem newItem = new ToDoItem
            {
                Id = newId,
                Title = "New Item",
                IsDone = false
            };

        ToDoItems.Add(newItem);
        StateHasChanged();
    }



    private void DeleteItem()
    {
        ToDoItem itemToDelete = ToDoItems.FirstOrDefault(item => item.Id == SelectedItemId.Value);
        ToDoItems.Remove(itemToDelete);
        SelectFirstItem();
        StateHasChanged();
    }

    private void SelectFirstItem()
    {
        SelectedItemId = ToDoItems.Any() ? ToDoItems.Min(item => (int?)item.Id) : null; // Select the first item
    }

    private void SetPreviousDay() {
        SelectedDate = SelectedDate.AddDays(-1);
    }

    private void SetNextDay() {
        SelectedDate = SelectedDate.AddDays(1);
    }

    public void SetToday(){
        SelectedDate = DateTime.Now;
    }

}
